<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Request an Invitation | StoryAlive</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- Additional Meta Tags for Better Support -->
    <meta name="theme-color" content="#0a0f0a">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0a0f0a;
            --accent: #4ade80;
            --accent-bright: #6ee7b7;
            --gold: #fbbf24;
            --text: #ffffff;
            --text-muted: #d1d5db;
            --glass: rgba(74, 222, 128, 0.15);
            --glass-border: rgba(74, 222, 128, 0.4);
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(180deg, #0a0f0a 0%, #050a05 100%);
            color: var(--text);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden; 
        }

        .container {
            max-width: 800px;
            margin: 60px auto;
            background: var(--glass);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            z-index: 1;
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.4),
                        0 0 100px rgba(74, 222, 128, 0.1);
        }

        .form-header {
            background: linear-gradient(135deg, var(--primary) 0%, #1a2e1a 100%);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
            border-bottom: 1px solid var(--glass-border);
            overflow: hidden;
        }

        .form-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            animation: scanline 3s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .form-header h1 {
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 900;
            letter-spacing: -2px;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ffffff, var(--accent), #ffffff);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .form-header p {
            font-size: 1.2rem;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            padding: 3rem 2rem 2rem;
            margin-bottom: 0;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: none;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .progress-step::before {
            content: attr(data-step);
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            background: rgba(74, 222, 128, 0.1);
            border: 2px solid rgba(74, 222, 128, 0.3);
            border-radius: 50%;
            font-weight: bold;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }



        .progress-step span {
            display: block;
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .form-content {
            padding: 3rem 3rem 3rem;
            background: rgba(0, 0, 0, 0.2);
        }

        .form-section {
            margin-bottom: 4rem;
            padding: 2.5rem;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            border: 1px solid rgba(74, 222, 128, 0.1);
            position: relative;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(74, 222, 128, 0.3), transparent);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 2.5rem;
            padding-bottom: 1.2rem;
            border-bottom: 1px solid rgba(74, 222, 128, 0.2);
            letter-spacing: -1px;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100px;
            height: 3px;
            background: var(--accent);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text);
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        label .required {
            color: var(--accent);
        }

        input[type="text"],
        input[type="email"],
        input[type="url"],
        select,
        textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(74, 222, 128, 0.2);
            border-radius: 12px;
            font-size: 1rem;
            color: var(--text);
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            font-family: 'Inter', -apple-system, sans-serif;
        }

        input::placeholder,
        textarea::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        /* Fix autofill background color */
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active,
        select:-webkit-autofill,
        select:-webkit-autofill:hover,
        select:-webkit-autofill:focus,
        select:-webkit-autofill:active {
            -webkit-background-clip: text;
            -webkit-text-fill-color: var(--text);
            transition: background-color 5000s ease-in-out 0s;
            box-shadow: inset 0 0 20px 20px rgba(0, 0, 0, 0.5);
        }

        input:-webkit-autofill::first-line {
            color: var(--text);
        }

        /* Custom dropdown styling */
        .select-wrapper {
            position: relative;
            width: 100%;
        }

        .select-wrapper::after {
            content: '';
            position: absolute;
            right: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 6px solid rgba(255, 255, 255, 0.5);
            pointer-events: none;
            transition: transform 0.3s ease;
        }

        .select-wrapper.open::after {
            transform: translateY(-50%) rotate(180deg);
        }

        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 3rem;
        }

        select option {
            background: var(--primary);
            color: var(--text);
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(0, 0, 0, 0.7);
            box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.1),
                        0 10px 30px rgba(74, 222, 128, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Phone input wrapper styles */
        .phone-input-wrapper {
            display: flex;
            gap: 0.75rem;
            align-items: stretch;
        }

        .phone-input-wrapper .select-wrapper {
            width: 70px;
            flex-shrink: 0;
        }

        .phone-input-wrapper select {
            width: 100%;
            padding: 1.125rem 0.75rem;
            font-size: 0.85rem;
            padding-right: 2rem;
        }

        .phone-input-wrapper .select-wrapper::after {
            right: 0.5rem;
            border-left: 3px solid transparent;
            border-right: 3px solid transparent;
            border-top: 4px solid rgba(255, 255, 255, 0.5);
        }

        .phone-input-wrapper input[type="text"] {
            flex: 1;
            min-width: 0;
        }

        select[data-country-select] option {
            padding: 0.5rem;
        }

        .microcopy {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 0.5rem;
            font-style: normal;
            line-height: 1.4;
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .radio-item,
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(74, 222, 128, 0.1);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            cursor: pointer;
        }

        @media (min-width: 1024px) {
            .radio-item:hover,
            .checkbox-item:hover {
                background: rgba(74, 222, 128, 0.05);
                border-color: rgba(74, 222, 128, 0.3);
                transform: translateX(5px);
            }
        }

        @media (max-width: 1023px) {
            .radio-item:hover,
            .checkbox-item:hover {
                background: rgba(74, 222, 128, 0.05);
                border-color: rgba(74, 222, 128, 0.3);
                /* No transform on tablet/mobile */
            }
        }

        .radio-item input[type="radio"],
        .checkbox-item input[type="checkbox"] {
            margin-right: 1rem;
            margin-top: 0.25rem;
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .radio-item input[type="radio"]:focus,
        .checkbox-item input[type="checkbox"]:focus {
            outline: none !important;
            box-shadow: none !important;
        }

        .radio-item input[type="radio"]:focus-visible,
        .checkbox-item input[type="checkbox"]:focus-visible {
            outline: none !important;
            box-shadow: none !important;
        }

        .radio-item input[type="radio"],
        .checkbox-item input[type="checkbox"] {
            accent-color: var(--accent);
        }

        .radio-item > div,
        .checkbox-item > div {
            font-weight: 500;
            margin-bottom: 0;
            color: var(--text);
            flex: 1;
        }

        .radio-description {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 0.25rem;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--glass-border);
        }

        .btn {
            padding: 18px 45px;
            border: none;
            border-radius: 100px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', -apple-system, sans-serif;
            letter-spacing: 0.5px;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn-primary {
            background: white;
            color: var(--primary);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: var(--accent);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
            z-index: -1;
        }

        .btn-primary:hover:not(:disabled) {
            color: white;
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(74, 222, 128, 0.3);
        }

        .btn-primary:hover:not(:disabled)::before {
            width: 500px;
            height: 500px;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
            color: var(--text);
            transform: scale(1.02);
        }

        #formMessage {
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
            text-align: center;
            display: none;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        #formMessage.success {
            background: rgba(74, 222, 128, 0.2);
            color: var(--accent-bright);
            border: 1px solid var(--accent);
            display: block;
            animation: slideInUp 0.5s ease;
        }

        #formMessage.error {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.5);
            display: block;
            animation: shake 0.5s ease;
        }

        #formMessage.loading {
            background: rgba(74, 222, 128, 0.1);
            color: var(--accent);
            border: 1px solid rgba(74, 222, 128, 0.3);
            display: block;
            animation: pulse 2s infinite;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Investor Evidence Section */
        .investor-evidence-section {
            background: rgba(74, 222, 128, 0.05);
            border: 1px solid rgba(74, 222, 128, 0.2);
        }

        .investor-text {
            color: var(--text-muted);
            line-height: 1.6;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        /* Validation Error Styles */
        .field-error {
            border-color: #ef4444 !important;
            background: rgba(239, 68, 68, 0.05) !important;
            animation: shake 0.3s ease;
        }

        .validation-message {
            color: #fca5a5;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            border-radius: 4px;
            display: none;
        }

        .validation-message.show {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        #loiValidationMessage {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(239, 68, 68, 0.15);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            text-align: center;
            display: none;
            font-size: 0.95rem;
        }

        #loiValidationMessage.show {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        .btn-loi {
            padding: 18px 45px;
            border: none;
            border-radius: 100px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', -apple-system, sans-serif;
            letter-spacing: 0.5px;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
            z-index: 1;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-bright) 100%);
            color: var(--primary);
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.3);
            min-width: 260px; /* Match the home page button width */
        }

        .btn-loi:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(74, 222, 128, 0.4);
        }

        /* LOI Modal Styles */
        .loi-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .loi-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loi-modal-content {
            background: var(--primary);
            width: 90%;
            max-width: 900px;
            height: 90vh;
            border-radius: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
                        0 0 100px rgba(74, 222, 128, 0.1);
            border: 1px solid var(--glass-border);
            overflow: hidden;
        }

        .loi-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: var(--primary);
            border: 2px solid var(--accent);
            border-radius: 50%;
            font-size: 24px;
            line-height: 1;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .loi-modal-close:hover {
            background: var(--accent);
            color: var(--primary);
            transform: scale(1.1);
        }

        .loi-modal-close:active {
            transform: scale(0.95);
        }

        .loi-modal-body {
            flex: 1;
            padding: 2rem;
            padding-bottom: 3rem;
            overflow-y: auto;
            overflow-x: hidden;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) rgba(255, 255, 255, 0.1);
        }

        .loi-modal-body::-webkit-scrollbar {
            width: 12px;
        }

        .loi-modal-body::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }

        .loi-modal-body::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 6px;
            border: 2px solid transparent;
            background-clip: content-box;
        }

        .loi-modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--accent-bright);
            background-clip: content-box;
        }

        #signwell-iframe-container {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        #signwell-iframe-container iframe {
            width: 100% !important;
            height: 100% !important;
            border: none;
            border-radius: 12px;
        }

        .loi-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
        }

        .loi-spinner {
            border: 3px solid rgba(74, 222, 128, 0.1);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 1.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loi-error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .loi-success-message {
            background: rgba(74, 222, 128, 0.2);
            color: var(--accent-bright);
            border: 1px solid var(--accent);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        /* Responsive Design - Comprehensive */

        /* Large Desktop: 1440px and up */
        @media (min-width: 1440px) {
            .container {
                max-width: 900px;
            }
        }

        /* Desktop: 1024px to 1439px */
        @media (max-width: 1439px) {
            .container {
                max-width: 800px;
            }
        }

        /* Tablet: 768px to 1023px */
        @media (max-width: 1023px) {
            .container {
                margin: 40px auto;
            }

            .form-header {
                padding: 3rem 1.5rem;
            }

            .form-section {
                padding: 2rem;
                margin-bottom: 3rem;
            }

            .form-content {
                padding: 2rem 2rem;
            }
        }

        /* Mobile: 481px to 767px */
        @media (max-width: 767px) {
            /* LOI Modal Mobile Styles - Full screen */
            .loi-modal {
                padding: 0;
            }

            .loi-modal-content {
                width: 100%;
                height: 100vh;
                max-width: 100%;
                border-radius: 0;
                margin: 0;
            }

            .loi-modal-close {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
                font-size: 20px;
                z-index: 20;
            }

            .loi-modal-body {
                padding: 0;
                border-radius: 0;
            }

            #signwell-iframe-container {
                border-radius: 0;
            }

            .investor-text {
                font-size: 0.9rem;
            }

            .btn-loi {
                width: 100%;
                max-width: none;
            }

            body {
                padding: 0;
            }

            .container {
                margin: 0;
                border-radius: 0;
                max-width: 100%;
            }

            .form-header {
                padding: 2.5rem 1.5rem;
                border-radius: 0;
            }

            .form-header h1 {
                font-size: 2rem;
                letter-spacing: -1px;
            }

            .form-header p {
                font-size: 1rem;
            }

            .progress-bar {
                display: none; /* Hide entire progress bar on mobile */
            }

            .form-content {
                padding: 1.5rem 1.5rem;
            }

            .form-section {
                padding: 1.75rem;
                margin-bottom: 2.5rem;
                border-radius: 15px;
            }

            .section-title {
                font-size: 1.5rem;
                margin-bottom: 1.75rem;
            }

            .form-group {
                margin-bottom: 1.25rem;
            }

            input[type="text"],
            input[type="email"],
            input[type="url"],
            select,
            textarea {
                padding: 0.875rem 1rem;
                font-size: 16px !important; /* Prevents zoom on iOS */
                -webkit-text-size-adjust: 100%; /* Prevent font scaling in landscape */
            }

            .radio-item,
            .checkbox-item {
                padding: 0.875rem;
            }

            .btn {
                padding: 16px 35px;
                font-size: 16px;
                width: 100%;
                max-width: none;
            }

            .btn-secondary {
                margin-bottom: 1rem;
            }

            .form-actions {
                flex-direction: column-reverse;
                gap: 1rem;
            }
        }

        /* Small Mobile: 480px and below */
        @media (max-width: 480px) {
            .form-header {
                padding: 2rem 1rem;
            }

            .form-header h1 {
                font-size: 1.75rem;
            }

            .form-header p {
                font-size: 0.95rem;
            }


            .form-content {
                padding: 1rem 1rem;
            }

            .form-section {
                padding: 1.25rem;
                margin-bottom: 2rem;
            }

            .section-title {
                font-size: 1.3rem;
                margin-bottom: 1.5rem;
            }

            label {
                font-size: 0.9rem;
            }

            .microcopy,
            .radio-description {
                font-size: 11px;
            }

            input[type="text"],
            input[type="email"],
            input[type="url"],
            select,
            textarea {
                padding: 0.75rem 0.875rem;
            }

            .radio-item,
            .checkbox-item {
                padding: 0.75rem;
            }

            .radio-item input[type="radio"],
            .checkbox-item input[type="checkbox"] {
                width: 18px;
                height: 18px;
            }

            .btn {
                padding: 14px 28px;
                font-size: 15px;
            }

            #formMessage {
                padding: 1rem;
                font-size: 14px;
            }
        }

        
        /* Very Small Mobile: 374px and below */
        @media (max-width: 374px) {
            .form-header h1 {
                font-size: 1.5rem;
            }

            .form-section {
                padding: 1rem;
            }

            .section-title {
                font-size: 1.2rem;
            }

            .btn {
                padding: 12px 24px;
                font-size: 14px;
            }
        }
    </style>
    <!-- SignWell Embedded Library -->
    <script type="text/javascript" src="https://static.signwell.com/assets/embedded.js"></script>
</head>
<body>
    <div class="container">
        <div class="form-header">
            <h1>Your Invitation</h1>
            <p>Tell us about yourself and your work as an author</p>
        </div>

        <form id="invitationForm" class="form-content">
            <!-- Section 1: About You -->
            <div class="form-section">
                <h2 class="section-title">Section 1: About You</h2>

                <div class="form-group">
                    <label for="firstName">First Name <span class="required">*</span></label>
                    <input type="text" id="firstName" name="firstName" required>
                </div>

                <div class="form-group">
                    <label for="lastName">Last Name <span class="required">*</span></label>
                    <input type="text" id="lastName" name="lastName" required>
                </div>

                <div class="form-group">
                    <label for="penName">Pen Name (if different)</label>
                    <input type="text" id="penName" name="penName">
                </div>

                <div class="form-group">
                    <label for="email">Email Address <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="phoneNumber">Phone Number (Optional)</label>
                    <div class="phone-input-wrapper">
                        <div class="select-wrapper">
                            <select id="countryCode" name="countryCode" title="Select your country code" data-country-select>
                                <option value="+1" data-display="+1">USA</option>
                                <option value="+1" data-display="+1">Canada</option>
                                <option value="+44" data-display="+44">United Kingdom</option>
                                <option value="+61" data-display="+61">Australia</option>
                                <option value="+64" data-display="+64">New Zealand</option>
                                <option value="+353" data-display="+353">Ireland</option>
                                <option value="+33" data-display="+33">France</option>
                                <option value="+49" data-display="+49">Germany</option>
                                <option value="+39" data-display="+39">Italy</option>
                                <option value="+34" data-display="+34">Spain</option>
                                <option value="+31" data-display="+31">Netherlands</option>
                                <option value="+32" data-display="+32">Belgium</option>
                                <option value="+43" data-display="+43">Austria</option>
                                <option value="+41" data-display="+41">Switzerland</option>
                                <option value="+46" data-display="+46">Sweden</option>
                                <option value="+47" data-display="+47">Norway</option>
                                <option value="+45" data-display="+45">Denmark</option>
                                <option value="+358" data-display="+358">Finland</option>
                                <option value="+48" data-display="+48">Poland</option>
                                <option value="+351" data-display="+351">Portugal</option>
                                <option value="+30" data-display="+30">Greece</option>
                                <option value="+420" data-display="+420">Czech Republic</option>
                                <option value="+36" data-display="+36">Hungary</option>
                                <option value="+40" data-display="+40">Romania</option>
                                <option value="+55" data-display="+55">Brazil</option>
                                <option value="+52" data-display="+52">Mexico</option>
                                <option value="+54" data-display="+54">Argentina</option>
                                <option value="+91" data-display="+91">India</option>
                                <option value="+81" data-display="+81">Japan</option>
                                <option value="+84" data-display="+84">Vietnam</option>
                                <option value="+27" data-display="+27">South Africa</option>
                            </select>
                        </div>
                        <input type="text" id="phoneNumber" name="phoneNumber" placeholder="123 456 7890">
                    </div>
                </div>

                <div class="form-group">
                    <label for="authorProfileLink">Primary Author Profile Link <span class="required">*</span></label>
                    <input type="text" id="authorProfileLink" name="authorProfileLink" required pattern="^(https?:\/\/)?.+\..+$" title="Please enter a valid URL (e.g., example.com or https://example.com)">
                    <p class="microcopy">Please provide the one single link that serves as the best central hub for you and your work. This helps us get a complete picture of you as an author.</p>
                </div>
            </div>

            <!-- Section 2: Your Author Profile & Audience -->
            <div class="form-section">
                <h2 class="section-title">Section 2: Your Author Profile & Audience</h2>

                <div class="form-group">
                    <label>How would you best describe your publishing experience? <span class="required">*</span></label>
                    <p class="microcopy">Select the one that best represents you</p>
                    <div class="radio-group">
                        <label class="radio-item" for="independent">
                            <input type="radio" id="independent" name="publishingExperience" value="independent" required>
                            <div>
                                Primarily Independent / Self-Published
                                <div class="radio-description">You publish your own ebooks, print books, or web novels.</div>
                            </div>
                        </label>
                        <label class="radio-item" for="traditional">
                            <input type="radio" id="traditional" name="publishingExperience" value="traditional" required>
                            <div>
                                Primarily Traditionally Published
                                <div class="radio-description">You work with a publishing house like Penguin Random House.</div>
                            </div>
                        </label>
                        <label class="radio-item" for="hybrid">
                            <input type="radio" id="hybrid" name="publishingExperience" value="hybrid" required>
                            <div>
                                Hybrid
                                <div class="radio-description">You have a mix of both self-published and traditionally published works.</div>
                            </div>
                        </label>
                        <label class="radio-item" for="aspiring">
                            <input type="radio" id="aspiring" name="publishingExperience" value="aspiring" required>
                            <div>
                                Aspiring / Pre-Published
                                <div class="radio-description">You have a completed manuscript but have not yet made it publicly available.</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>What is your primary release style? <span class="required">*</span></label>
                    <p class="microcopy">Select the one that best describes your process</p>
                    <div class="radio-group">
                        <label class="radio-item" for="completed">
                            <input type="radio" id="completed" name="releaseStyle" value="completed" required>
                            <div>
                                Completed Works
                                <div class="radio-description">You write and release your stories as complete, standalone products.</div>
                            </div>
                        </label>
                        <label class="radio-item" for="serialized">
                            <input type="radio" id="serialized" name="releaseStyle" value="serialized" required>
                            <div>
                                Serialized Works
                                <div class="radio-description">You write and release your stories in an ongoing, chapter-by-chapter format.</div>
                            </div>
                        </label>
                        <label class="radio-item" for="both">
                            <input type="radio" id="both" name="releaseStyle" value="both" required>
                            <div>
                                Hybrid / Both
                                <div class="radio-description">You actively use both release styles for different projects.</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>What formats is your work currently available in? <span class="required">*</span></label>
                    <p class="microcopy">Check all that apply</p>
                    <div class="checkbox-group">
                        <label class="checkbox-item" for="ebook">
                            <input type="checkbox" id="ebook" name="formats" value="ebook">
                            <div>Ebook</div>
                        </label>
                        <label class="checkbox-item" for="print">
                            <input type="checkbox" id="print" name="formats" value="print">
                            <div>Print</div>
                        </label>
                        <label class="checkbox-item" for="webNovel">
                            <input type="checkbox" id="webNovel" name="formats" value="webNovel">
                            <div>Web Novel</div>
                        </label>
                        <label class="checkbox-item" for="audiobook">
                            <input type="checkbox" id="audiobook" name="formats" value="audiobook">
                            <div>Audiobook</div>
                        </label>
                        <label class="checkbox-item" for="graphicNovel">
                            <input type="checkbox" id="graphicNovel" name="formats" value="graphicNovel">
                            <div>Graphic Novel / Webtoon</div>
                        </label>
                        <label class="checkbox-item" for="otherFormat">
                            <input type="checkbox" id="otherFormat" name="formats" value="other">
                            <div>Other</div>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="primaryGenre">What is your primary genre? <span class="required">*</span></label>
                    <p class="microcopy">Select the one that best fits your work</p>
                    <div class="select-wrapper">
                    <select id="primaryGenre" name="primaryGenre" required>
                        <option value="">Select a genre...</option>
                        <option value="fantasy">Fantasy</option>
                        <option value="scienceFiction">Science Fiction</option>
                        <option value="romance">Romance</option>
                        <option value="thriller">Thriller</option>
                        <option value="mystery">Mystery</option>
                        <option value="horror">Horror</option>
                        <option value="litrpg">LitRPG / GameLit</option>
                        <option value="paranormal">Paranormal / Urban Fantasy</option>
                        <option value="ya">Young Adult (YA)</option>
                        <option value="historical">Historical Fiction</option>
                        <option value="western">Western</option>
                        <option value="other">Other</option>
                    </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="subgenre">Subgenre / Niche (Optional)</label>
                    <input type="text" id="subgenre" name="subgenre" placeholder='e.g., "Cozy Fantasy", "Adventure", "Dystopian", "Billionaire Romance"'>
                </div>

                <div class="form-group">
                    <label for="communityHub">Primary Community Hub <span class="required">*</span></label>
                    <input type="text" id="communityHub" name="communityHub" required pattern="^(https?:\/\/)?.+\..+$" title="Please enter a valid URL (e.g., example.com or https://example.com)">
                    <p class="microcopy">Please link to the single online space where you have the most active and engaged community. This could be your Discord server, TikTok, Instagram, Facebook Group, or any other platform where you connect most with your readers.</p>
                </div>

                <div class="form-group">
                    <label for="mailingListSize">What is the approximate size of your author mailing list? <span class="required">*</span></label>
                    <div class="select-wrapper">
                    <select id="mailingListSize" name="mailingListSize" required>
                        <option value="">Select a range...</option>
                        <option value="none">I don't currently have a mailing list</option>
                        <option value="0-1000">0 - 1,000 subscribers</option>
                        <option value="1001-5000">1,001 - 5,000 subscribers</option>
                        <option value="5001-10000">5,001 - 10,000 subscribers</option>
                        <option value="10001-25000">10,001 - 25,000 subscribers</option>
                        <option value="25001+">25,001+ subscribers</option>
                    </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="paidSubscribers">If you have paid subscribers, roughly how many do you have?</label>
                    <div class="select-wrapper">
                    <select id="paidSubscribers" name="paidSubscribers">
                        <option value="">Select a range...</option>
                        <option value="0">0 / Not Applicable</option>
                        <option value="1-100">1 - 100</option>
                        <option value="101-500">101 - 500</option>
                        <option value="501-2500">501 - 2,500</option>
                        <option value="2501-10000">2,501 - 10,000</option>
                        <option value="10000+">10,000+</option>
                    </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="totalSales">If you've sold copies of your work, roughly how many have you sold in total (ebooks or physical copies)?</label>
                    <div class="select-wrapper">
                    <select id="totalSales" name="totalSales">
                        <option value="">Select a range...</option>
                        <option value="0">0 / Haven't sold copies yet</option>
                        <option value="1-100">1 - 100</option>
                        <option value="101-1000">101 - 1,000</option>
                        <option value="1001-10000">1,001 - 10,000</option>
                        <option value="10001-50000">10,001 - 50,000</option>
                        <option value="50000+">50,000+</option>
                    </select>
                    </div>
                </div>
            </div>

            <!-- Section 3: Partnership -->
            <div class="form-section">
                <h2 class="section-title">Section 3: Partnership</h2>

                <div class="form-group">
                    <label for="platformAppeal">What aspects of our platform are most appealing to you? <span class="required">*</span></label>
                    <textarea id="platformAppeal" name="platformAppeal" required></textarea>
                </div>

                <div class="form-group">
                    <label for="questions">Do you have any immediate questions or concerns about our platform? (Optional)</label>
                    <textarea id="questions" name="questions"></textarea>
                </div>

                <div class="form-group">
                    <label for="referralSource">How did you hear about us? (Optional)</label>
                    <div class="select-wrapper">
                    <select id="referralSource" name="referralSource">
                        <option value="">Select an option...</option>
                        <option value="searchEngine">Search Engine (e.g., Google, Bing)</option>
                        <option value="socialMedia">Social Media (e.g., TikTok, Instagram, Facebook, X)</option>
                        <option value="youtube">YouTube</option>
                        <option value="article">Online Article or Blog Post</option>
                        <option value="referral">Author or Friend Referral</option>
                        <option value="community">Writer's Community (e.g., Reddit, Discord, Forum)</option>
                        <option value="other">Other</option>
                    </select>
                    </div>
                </div>
            </div>

            <!-- Hidden fields for tracking -->
            <input type="hidden" id="origination" name="origination" value="Direct - Average">
            <input type="hidden" id="formOpenedAt" name="formOpenedAt" value="">

            <!-- Honeypot field - hidden from real users but bots will fill it -->
            <div style="position: absolute; left: -9999px;">
                <label for="website">Website</label>
                <input type="text" id="website" name="website" tabindex="-1" autocomplete="off">
            </div>

            <!-- Section 4: Investor Evidence -->
            <div class="form-section investor-evidence-section">
                <h2 class="section-title">Investor Evidence</h2>
                <p class="investor-text">This LOI is what we show to investors. It's not legally binding in any way, but they hold more weight to investors than just collecting emails.</p>
                <div style="display: flex; justify-content: center;">
                    <button type="button" class="btn btn-loi" id="viewLoiBtn">View LOI</button>
                </div>
                <div id="loiValidationMessage"></div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='/author'">Cancel</button>
            </div>

            <div id="formMessage"></div>
        </form>
    </div>

    <!-- LOI Modal -->
    <div id="loiModal" class="loi-modal">
        <div class="loi-modal-content">
            <button class="loi-modal-close" id="closeLoiModal">&times;</button>
            <div class="loi-modal-body">
                <div id="signwell-iframe-container">
                    <div class="loi-loading">
                        <div class="loi-spinner"></div>
                        <p>Loading document...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration for SignWell
        const SIGNWELL_CONFIG = {
            TEMPLATE_ID: 'd285b005-670c-4154-88f2-14b59a69f75f', // Your SignWell template ID
            // Use full URL for local development, relative path for production
            CREATE_DOCUMENT_ENDPOINT: window.location.hostname === 'localhost'
                ? 'http://localhost:3001/api/create-loi-document'
                : '/api/create-loi-document'
        };

        // Set form opened timestamp when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const formattedDate = now.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.getElementById('formOpenedAt').value = formattedDate;

            // Setup country dropdown display
            const countrySelect = document.querySelector('[data-country-select]');
            if (countrySelect) {
                // Store countries in alphabetical order with USA first
                const countries = [
                    { value: '+1', display: '+1', name: 'USA' },
                    { value: '+54', display: '+54', name: 'Argentina' },
                    { value: '+61', display: '+61', name: 'Australia' },
                    { value: '+43', display: '+43', name: 'Austria' },
                    { value: '+32', display: '+32', name: 'Belgium' },
                    { value: '+55', display: '+55', name: 'Brazil' },
                    { value: '+1', display: '+1', name: 'Canada' },
                    { value: '+420', display: '+420', name: 'Czech Republic' },
                    { value: '+45', display: '+45', name: 'Denmark' },
                    { value: '+358', display: '+358', name: 'Finland' },
                    { value: '+33', display: '+33', name: 'France' },
                    { value: '+49', display: '+49', name: 'Germany' },
                    { value: '+30', display: '+30', name: 'Greece' },
                    { value: '+36', display: '+36', name: 'Hungary' },
                    { value: '+91', display: '+91', name: 'India' },
                    { value: '+353', display: '+353', name: 'Ireland' },
                    { value: '+39', display: '+39', name: 'Italy' },
                    { value: '+81', display: '+81', name: 'Japan' },
                    { value: '+52', display: '+52', name: 'Mexico' },
                    { value: '+31', display: '+31', name: 'Netherlands' },
                    { value: '+64', display: '+64', name: 'New Zealand' },
                    { value: '+47', display: '+47', name: 'Norway' },
                    { value: '+48', display: '+48', name: 'Poland' },
                    { value: '+351', display: '+351', name: 'Portugal' },
                    { value: '+40', display: '+40', name: 'Romania' },
                    { value: '+27', display: '+27', name: 'South Africa' },
                    { value: '+34', display: '+34', name: 'Spain' },
                    { value: '+46', display: '+46', name: 'Sweden' },
                    { value: '+41', display: '+41', name: 'Switzerland' },
                    { value: '+44', display: '+44', name: 'United Kingdom' },
                    { value: '+84', display: '+84', name: 'Vietnam' }
                ];

                function updateDropdownDisplay() {
                    const selectedIndex = countrySelect.selectedIndex;
                    const selectedCountry = countries[selectedIndex];

                    countries.forEach((country, index) => {
                        const option = countrySelect.options[index];
                        if (document.activeElement === countrySelect) {
                            option.textContent = country.name;
                        } else {
                            option.textContent = country.display;
                        }
                    });
                }

                countrySelect.addEventListener('focus', updateDropdownDisplay);
                countrySelect.addEventListener('blur', updateDropdownDisplay);
                countrySelect.addEventListener('change', updateDropdownDisplay);

                updateDropdownDisplay();
            }
        });

        // Validate form fields with visual feedback
        function validateRequiredFields() {
            const validationMessage = document.getElementById('loiValidationMessage');

            // Get all required fields
            const firstName = document.getElementById('firstName');
            const lastName = document.getElementById('lastName');
            const email = document.getElementById('email');
            const authorProfileLink = document.getElementById('authorProfileLink');
            const primaryGenre = document.getElementById('primaryGenre');
            const communityHub = document.getElementById('communityHub');
            const mailingListSize = document.getElementById('mailingListSize');
            const platformAppeal = document.getElementById('platformAppeal');

            let isValid = true;
            let missingFields = [];
            let firstErrorField = null;

            // Clear previous error states for all input fields
            const allFields = [firstName, lastName, email, authorProfileLink, primaryGenre,
                             communityHub, mailingListSize, platformAppeal];
            allFields.forEach(field => {
                if (field) field.classList.remove('field-error');
            });

            // Clear radio button error states
            document.querySelectorAll('.radio-item').forEach(item => {
                item.classList.remove('field-error');
            });

            // Clear checkbox error states
            document.querySelectorAll('.checkbox-item').forEach(item => {
                item.classList.remove('field-error');
            });

            validationMessage.classList.remove('show');

            // Check first name
            if (!firstName.value || firstName.value.trim() === '') {
                firstName.classList.add('field-error');
                missingFields.push('First Name');
                if (!firstErrorField) firstErrorField = firstName;
                isValid = false;
            }

            // Check last name
            if (!lastName.value || lastName.value.trim() === '') {
                lastName.classList.add('field-error');
                missingFields.push('Last Name');
                if (!firstErrorField) firstErrorField = lastName;
                isValid = false;
            }

            // Check email
            if (!email.value || email.value.trim() === '') {
                email.classList.add('field-error');
                missingFields.push('Email');
                if (!firstErrorField) firstErrorField = email;
                isValid = false;
            } else if (!email.value.includes('@')) {
                email.classList.add('field-error');
                missingFields.push('Valid Email');
                if (!firstErrorField) firstErrorField = email;
                isValid = false;
            }

            // Check author profile link
            if (!authorProfileLink.value || authorProfileLink.value.trim() === '') {
                authorProfileLink.classList.add('field-error');
                missingFields.push('Primary Author Profile Link');
                if (!firstErrorField) firstErrorField = authorProfileLink;
                isValid = false;
            }

            // Check publishing experience (radio)
            const publishingExperience = document.querySelector('input[name="publishingExperience"]:checked');
            if (!publishingExperience) {
                document.querySelectorAll('input[name="publishingExperience"]').forEach(radio => {
                    radio.closest('.radio-item').classList.add('field-error');
                });
                missingFields.push('Publishing Experience');
                if (!firstErrorField) firstErrorField = document.querySelector('input[name="publishingExperience"]');
                isValid = false;
            }

            // Check release style (radio)
            const releaseStyle = document.querySelector('input[name="releaseStyle"]:checked');
            if (!releaseStyle) {
                document.querySelectorAll('input[name="releaseStyle"]').forEach(radio => {
                    radio.closest('.radio-item').classList.add('field-error');
                });
                missingFields.push('Release Style');
                if (!firstErrorField) firstErrorField = document.querySelector('input[name="releaseStyle"]');
                isValid = false;
            }

            // Check formats (at least one checkbox must be selected)
            const formats = document.querySelectorAll('input[name="formats"]:checked');
            if (formats.length === 0) {
                document.querySelectorAll('input[name="formats"]').forEach(checkbox => {
                    checkbox.closest('.checkbox-item').classList.add('field-error');
                });
                missingFields.push('At least one Format');
                if (!firstErrorField) firstErrorField = document.querySelector('input[name="formats"]');
                isValid = false;
            }

            // Check primary genre
            if (!primaryGenre.value || primaryGenre.value === '') {
                primaryGenre.classList.add('field-error');
                missingFields.push('Primary Genre');
                if (!firstErrorField) firstErrorField = primaryGenre;
                isValid = false;
            }

            // Check community hub
            if (!communityHub.value || communityHub.value.trim() === '') {
                communityHub.classList.add('field-error');
                missingFields.push('Primary Community Hub');
                if (!firstErrorField) firstErrorField = communityHub;
                isValid = false;
            }

            // Check mailing list size
            if (!mailingListSize.value || mailingListSize.value === '') {
                mailingListSize.classList.add('field-error');
                missingFields.push('Mailing List Size');
                if (!firstErrorField) firstErrorField = mailingListSize;
                isValid = false;
            }

            // Check platform appeal
            if (!platformAppeal.value || platformAppeal.value.trim() === '') {
                platformAppeal.classList.add('field-error');
                missingFields.push('Platform Appeal');
                if (!firstErrorField) firstErrorField = platformAppeal;
                isValid = false;
            }

            // Show validation message if invalid
            if (!isValid) {
                if (missingFields.length === 1) {
                    validationMessage.textContent = `Please fill in: ${missingFields[0]}`;
                } else if (missingFields.length <= 3) {
                    validationMessage.textContent = `Please fill in the following required fields: ${missingFields.join(', ')}.`;
                } else {
                    validationMessage.textContent = `Please complete all required fields (${missingFields.length} remaining).`;
                }
                validationMessage.classList.add('show');

                // Smooth scroll to first error field
                if (firstErrorField) {
                    // For radio/checkbox groups, scroll to the container
                    const scrollTarget = firstErrorField.closest('.form-group') || firstErrorField;
                    scrollTarget.scrollIntoView({ behavior: 'smooth', block: 'center' });

                    // Focus if it's a focusable element
                    setTimeout(() => {
                        if (firstErrorField.focus) {
                            firstErrorField.focus();
                        }
                    }, 500);
                }
            }

            return isValid;
        }

        // Collect form data for LOI
        function collectFormDataForLOI() {
            const form = document.getElementById('invitationForm');
            const formData = new FormData(form);

            const firstName = formData.get('firstName');
            const lastName = formData.get('lastName');
            const fullName = `${firstName} ${lastName}`;
            const email = formData.get('email');

            const data = {
                // Data for creating the document
                fullName: fullName,
                firstName: firstName,
                lastName: lastName,
                email: email,
                phone: formData.get('phoneNumber') || '',
                platformAppeal: formData.get('platformAppeal') || '',
                questions: formData.get('questions') || ''
            };

            return data;
        }

        // Create SignWell document via backend
        async function createSignWellDocument() {
            const data = collectFormDataForLOI();

            // No more alerts - validation is handled separately
            if (!data.firstName || !data.lastName || !data.email || data.firstName.trim() === '') {
                console.error('Required fields are missing');
                return null;
            }

            try {
                // Call your backend endpoint to create the document
                const response = await fetch(SIGNWELL_CONFIG.CREATE_DOCUMENT_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        templateId: SIGNWELL_CONFIG.TEMPLATE_ID,
                        recipientName: data.fullName,
                        recipientEmail: data.email,
                        // SignWell template field mappings (API IDs)
                        fields: {
                            DateSigned_1: new Date().toLocaleDateString('en-US'), // Today's date
                            Name_1: data.fullName,  // First Name + Last Name
                            Email_1: data.email,    // Email Address
                            Name_2: data.firstName, // First Name only
                            Name_3: data.fullName   // First Name + Last Name
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to create document');
                }

                const result = await response.json();
                return result.embedded_signing_url;

            } catch (error) {
                console.error('Error creating SignWell document:', error);
                alert('There was an error preparing your LOI. Please ensure your backend endpoint is configured.');
                return null;
            }
        }

        // Show LOI modal with SignWell embedded document
        async function showLOI() {
            // Bot detection - check honeypot field BEFORE any API calls
            const honeypot = document.getElementById('website');
            if (honeypot && honeypot.value !== '') {
                // Bot detected - show fake success WITHOUT calling SignWell API
                console.log('Bot detected - blocking SignWell API call');
                const formMessage = document.getElementById('formMessage');
                formMessage.textContent = 'Thank you for your application! We\'ll review it and get back to you soon.';
                formMessage.className = 'success';

                // Clear the form
                document.getElementById('invitationForm').reset();

                // Redirect after delay
                setTimeout(() => {
                    window.location.href = '/author';
                }, 5000);
                return; // Don't open LOI or call SignWell API
            }

            // Validate required fields first
            if (!validateRequiredFields()) {
                return; // Exit if validation fails
            }

            // Add small delay to ensure form data is fully committed
            await new Promise(resolve => setTimeout(resolve, 100));

            const modal = document.getElementById('loiModal');
            const container = document.getElementById('signwell-iframe-container');

            // Show modal
            modal.classList.add('active');

            // Show loading state
            container.innerHTML = `
                <div class="loi-loading">
                    <div class="loi-spinner"></div>
                    <p>Preparing your Letter of Intent...</p>
                </div>
            `;

            // Get embedded signing URL from backend
            const embeddedSigningUrl = await createSignWellDocument();

            if (embeddedSigningUrl) {
                // Clear loading state
                container.innerHTML = '';

                // Initialize SignWell embed
                try {
                    const signWellEmbed = new SignWellEmbed({
                        url: embeddedSigningUrl,
                        containerId: 'signwell-iframe-container',
                        allowClose: true,
                        skipDeclineDocumentConfirm: false,
                        events: {
                            completed: (e) => {
                                console.log('Document signed successfully:', e);

                                // Show initial success message
                                container.innerHTML = `
                                    <div class="loi-success-message">
                                        <h3>Thank you!</h3>
                                        <p>Your Letter of Intent has been signed successfully.</p>
                                        <p>Submitting your information...</p>
                                    </div>
                                `;

                                // Submit the form data to Make.com
                                const form = document.getElementById('invitationForm');
                                const formData = new FormData(form);

                                // Handle checkboxes (formats) - collect all checked values
                                const formats = [];
                                const formatCheckboxes = document.querySelectorAll('input[name="formats"]:checked');
                                formatCheckboxes.forEach(checkbox => {
                                    formats.push(checkbox.value);
                                });

                                // Create data object
                                const data = {};
                                for (let [key, value] of formData.entries()) {
                                    // Skip individual format entries as we'll add them as an array
                                    if (key !== 'formats') {
                                        // Convert phone number to E.164 format for Brevo/API
                                        if (key === 'phoneNumber' && value && value.trim()) {
                                            const countryCode = document.getElementById('countryCode').value;
                                            const phoneNumber = value.trim();
                                            let cleanedPhone = phoneNumber.replace(/\D/g, '');

                                            const countriesRequiringZeroRemoval = ['+44', '+353', '+39', '+61', '+64', '+27'];
                                            if (countriesRequiringZeroRemoval.includes(countryCode) && cleanedPhone.startsWith('0')) {
                                                cleanedPhone = cleanedPhone.substring(1);
                                            }

                                            data[key] = countryCode + cleanedPhone;
                                        } else if (key !== 'countryCode') {
                                            data[key] = value;
                                        }
                                    }
                                }
                                // Add formats as array
                                data.formats = formats;

                                const webhookUrl = 'https://hook.us2.make.com/5tf3qw1kq7mq7d52ens1n5qeb3fpzq2g';

                                fetch(webhookUrl, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify(data),
                                })
                                .then(response => {
                                    if (response.ok) {
                                        // Update success message
                                        container.innerHTML = `
                                            <div class="loi-success-message">
                                                <h3>Thank you!</h3>
                                                <p>Your Letter of Intent has been signed, and your form has been submitted successfully.</p>
                                                <p>We'll be in touch soon after we secure investor funding.</p>
                                            </div>
                                        `;

                                        // Redirect after 10 seconds
                                        setTimeout(() => {
                                            window.location.href = '/author';
                                        }, 10000);
                                    } else {
                                        throw new Error('Submission failed');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error submitting form:', error);
                                    container.innerHTML = `
                                        <div class="loi-error-message">
                                            <h3>Almost there!</h3>
                                            <p>Your LOI was signed, but there was an error submitting your information.</p>
                                            <p>Please contact support or try again.</p>
                                        </div>
                                    `;
                                    setTimeout(() => {
                                        modal.classList.remove('active');
                                    }, 5000);
                                });
                            },
                            declined: (e) => {
                                console.log('Document declined:', e);
                                container.innerHTML = `
                                    <div class="loi-error-message">
                                        <p>You've declined the Letter of Intent.</p>
                                        <p>Feel free to review it again when you're ready.</p>
                                    </div>
                                `;
                                setTimeout(() => {
                                    modal.classList.remove('active');
                                }, 3000);
                            },
                            closed: (e) => {
                                console.log('SignWell closed:', e);
                            },
                            error: (e) => {
                                console.error('SignWell error:', e);
                                container.innerHTML = `
                                    <div class="loi-error-message">
                                        <p>An error occurred while loading the document.</p>
                                        <p>Please try again or contact support.</p>
                                    </div>
                                `;
                            }
                        }
                    });

                    signWellEmbed.open();
                } catch (error) {
                    console.error('Error initializing SignWell embed:', error);
                    container.innerHTML = `
                        <div class="loi-error-message">
                            <p>Unable to initialize the document viewer.</p>
                            <p>Please ensure SignWell library is loaded.</p>
                        </div>
                    `;
                }
            } else {
                // Error creating document
                container.innerHTML = `
                    <div class="loi-error-message">
                        <p>Unable to load the Letter of Intent.</p>
                        <p>Please ensure all required fields are filled and try again.</p>
                    </div>
                `;
            }
        }

        // Event Listeners for LOI
        document.getElementById('viewLoiBtn').addEventListener('click', showLOI);

        document.getElementById('closeLoiModal').addEventListener('click', () => {
            document.getElementById('loiModal').classList.remove('active');
        });

        // Clear error state when user starts typing in required fields
        ['firstName', 'lastName', 'email', 'authorProfileLink', 'communityHub', 'platformAppeal'].forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('input', function() {
                    this.classList.remove('field-error');
                    // Check if we should hide the validation message
                    checkAndHideValidationMessage();
                });
            }
        });

        // Clear error state for select dropdowns when changed
        ['primaryGenre', 'mailingListSize'].forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('change', function() {
                    this.classList.remove('field-error');
                    checkAndHideValidationMessage();
                });
            }
        });

        // Clear error state for radio buttons
        ['publishingExperience', 'releaseStyle'].forEach(radioName => {
            document.querySelectorAll(`input[name="${radioName}"]`).forEach(radio => {
                radio.addEventListener('change', function() {
                    document.querySelectorAll(`input[name="${radioName}"]`).forEach(r => {
                        r.closest('.radio-item').classList.remove('field-error');
                    });
                    checkAndHideValidationMessage();
                });
            });
        });

        // Clear error state for format checkboxes
        document.querySelectorAll('input[name="formats"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const hasChecked = document.querySelectorAll('input[name="formats"]:checked').length > 0;
                if (hasChecked) {
                    document.querySelectorAll('input[name="formats"]').forEach(cb => {
                        cb.closest('.checkbox-item').classList.remove('field-error');
                    });
                }
                checkAndHideValidationMessage();
            });
        });

        // Helper function to check if all required fields are filled and hide message
        function checkAndHideValidationMessage() {
            const validationMessage = document.getElementById('loiValidationMessage');

            // Quick check of key required fields
            const hasFirstName = document.getElementById('firstName').value.trim() !== '';
            const hasLastName = document.getElementById('lastName').value.trim() !== '';
            const hasEmail = document.getElementById('email').value.trim() !== '';
            const hasAuthorLink = document.getElementById('authorProfileLink').value.trim() !== '';
            const hasPubExp = document.querySelector('input[name="publishingExperience"]:checked') !== null;
            const hasReleaseStyle = document.querySelector('input[name="releaseStyle"]:checked') !== null;
            const hasFormats = document.querySelectorAll('input[name="formats"]:checked').length > 0;
            const hasGenre = document.getElementById('primaryGenre').value !== '';
            const hasCommunityHub = document.getElementById('communityHub').value.trim() !== '';
            const hasMailingList = document.getElementById('mailingListSize').value !== '';
            const hasPlatformAppeal = document.getElementById('platformAppeal').value.trim() !== '';

            // If all required fields are filled, hide the validation message
            if (hasFirstName && hasLastName && hasEmail && hasAuthorLink && hasPubExp &&
                hasReleaseStyle && hasFormats && hasGenre && hasCommunityHub &&
                hasMailingList && hasPlatformAppeal) {
                validationMessage.classList.remove('show');
            }
        }

        // Close modal when clicking outside
        document.getElementById('loiModal').addEventListener('click', (e) => {
            if (e.target.id === 'loiModal') {
                document.getElementById('loiModal').classList.remove('active');
            }
        });

        // Prevent default form submission - form now submits through SignWell
        document.getElementById('invitationForm').addEventListener('submit', function(event) {
            event.preventDefault();
            // Show LOI instead of submitting directly
            showLOI();
        });

        // Update progress bar based on section visibility with reveal animation
        const sections = document.querySelectorAll('.form-section');
        const progressSteps = document.querySelectorAll('.progress-step');
        const formGroups = document.querySelectorAll('.form-group');

        // Add reveal animation to form groups
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '0';
                    entry.target.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        entry.target.style.transition = 'all 0.6s cubic-bezier(0.23, 1, 0.32, 1)';
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }, 100);
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        formGroups.forEach(group => {
            observer.observe(group);
        });

        // Simple scroll-based progress indicator
        window.addEventListener('scroll', () => {
            const scrollPosition = window.scrollY + window.innerHeight / 2;

            sections.forEach((section, index) => {
                const sectionTop = section.offsetTop;
                const sectionBottom = sectionTop + section.offsetHeight;

                // Removed dynamic active class switching
            });
        });

        // Auto-format URLs to add https:// if missing
        function formatUrl(input) {
            let value = input.value.trim();
            if (value && !value.match(/^https?:\/\//)) {
                input.value = 'https://' + value;
            }
        }

        // Add blur event to URL inputs to auto-format
        document.getElementById('authorProfileLink').addEventListener('blur', function() {
            formatUrl(this);
        });

        document.getElementById('communityHub').addEventListener('blur', function() {
            formatUrl(this);
        });


        // Allow radio buttons to be unselected on second click
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('click', function(e) {
                // Store reference to current radio and its name group
                const radioName = this.name;
                const isCurrentlyChecked = this.hasAttribute('data-was-checked');

                // Clear all data-was-checked in this group
                document.querySelectorAll(`input[type="radio"][name="${radioName}"]`).forEach(r => {
                    r.removeAttribute('data-was-checked');
                });

                // If it was checked, uncheck it
                if (isCurrentlyChecked) {
                    this.checked = false;
                } else {
                    // Mark this one as checked
                    this.setAttribute('data-was-checked', 'true');
                }
            });
        });

        // Handle dropdown arrow animation
        document.querySelectorAll('select').forEach(select => {
            const wrapper = select.closest('.select-wrapper');

            select.addEventListener('focus', function() {
                if (wrapper) wrapper.classList.add('open');
            });

            select.addEventListener('blur', function() {
                if (wrapper) wrapper.classList.remove('open');
            });

            select.addEventListener('change', function() {
                if (wrapper) wrapper.classList.remove('open');
            });
        });
    </script>
    <!-- Vercel Analytics -->
    <script type="module" src="/analytics.js"></script>
</body>
</html>